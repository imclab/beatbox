var app=app||{};app.views={},app.models={},app.collections={},app.templates={},app.config={},this.app=this.app||{},this.app.templates=this.app.templates||{},this.app.templates.intro=function(e,t,n,r,i){return n=n||e.helpers,"<div>\n  This is how this works.\n</div>\n"},function(){app.models.AudioInput=Backbone.Model.extend({KICK:{low:0,high:500},SNARE:{low:700,high:5e3},THRESHOLD:.15,BUFFER_SIZE:2048,DECAY:.25,initialize:function(){var e=this;this.context=this.get("context"),this.wait=0,navigator.webkitGetUserMedia({audio:!0},function(t){e.fft=new FFT(e.BUFFER_SIZE,e.context.sampleRate),e.sourceNode=e.context.createMediaStreamSource(t),e.procNode=e.context.createJavaScriptNode(e.BUFFER_SIZE,1,1),e.sourceNode.connect(e.procNode),e.procNode.onaudioprocess=function(t){e.processAudio.call(e,t)},e.procNode.connect(e.context.destination)})},processAudio:function(e){this.wait-=this.DECAY,this.fft.forward(e.inputBuffer.getChannelData(0)),this.detectSound(this.fft.spectrum)},detectSound:function(e){var t;if(this.wait>0)return;t=this.spectralCentroid(e),t>0&&console.log("Centroid: "+t),t>=this.KICK.low&&t<=this.KICK.high?(this.wait=1,this.trigger("kick")):t>=this.SNARE.low&&t<=this.SNARE.high&&(this.wait=1,this.trigger("snare"))},spectralCentroid:function(e){var t,n,r=0,i=0;for(var s=0;s<e.length;s++)t=Math.abs(e[s])<this.THRESHOLD?0:e[s],n=this.nToFreq(s,this.context.sampleRate),r+=n*t,i+=t;return r/i},preCalcNToF:function(e){var t=[];for(var n=0;n<this.BUFFER_SIZE;n++)t=this.nToFreq(n,e);return t},nToFreq:function(e,t){return e*t/this.BUFFER_SIZE}})}(),function(){app.models.Sample=Backbone.Model.extend({PATH_ROOT:"audio/",initialize:function(){this.samplePath=this.get("samplePath"),this.audioInput=this.get("audioInput"),this.context=this.get("context"),this.triggerName=this.get("triggerName"),this.loadSample(),this.audioInput.on(this.triggerName,this.play,this)},setSample:function(e){this.samplePath=e,this.loadSample()},loadSample:function(){var e=this;allen.getBuffer(this.PATH_ROOT+this.samplePath,function(t){e.buffer=e.context.createBuffer(t.target.response,!1),e.trigger("loaded")})},play:function(){console.log("playing "+this.triggerName),this.bufferNode=this.context.createBufferSource(),this.bufferNode.buffer=this.buffer,this.bufferNode.connect(this.context.destination),this.bufferNode.noteOn(0)}})}(),function(){app.views.View=Backbone.View.extend({render:function(){this.template=this.template||Handlebars.template(app.templates[this.name]);var e=this.getRenderData?this.getRenderData():{};return this.$el.html(this.template(e)),console.log(this.$el.html()),this}})}(),function(){app.views.Intro=app.views.View.extend({name:"intro",className:"intro-view",initialize:function(e){}})}(),app.init=function(){app.introView=new app.views.Intro,app.context=allen.getAudioContext(),app.audioInput=new app.models.AudioInput({context:app.context}),app.snareSample=new app.models.Sample({context:app.context,audioInput:app.audioInput,samplePath:"rock_snare.wav",triggerName:"snare"}),app.kickSample=new app.models.Sample({context:app.context,audioInput:app.audioInput,samplePath:"rock_kick.wav",triggerName:"kick"}),$("#content").append(app.introView.render().$el)},$(function(){app.init.call(app)});